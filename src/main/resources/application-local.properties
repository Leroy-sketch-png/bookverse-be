# ==============================================================================
# LOCAL DEVELOPMENT CONFIGURATION
# ==============================================================================
# Use this profile for pure offline development with Docker PostgreSQL
# Start Docker: .\dev.bat -docker
# Then run with: -Dspring.profiles.active=local
# ==============================================================================

spring.application.name=BookverseServer
server.port=8080

# ==============================================================================
# 1. DATABASE (Local Docker PostgreSQL)
# ==============================================================================
# Simple connection - force UTC timezone in JDBC to avoid Asia/Saigon issues
spring.datasource.url=jdbc:postgresql://localhost:5432/bookversedb?options=-c%20TimeZone%3DUTC
spring.datasource.username=bookverse
spring.datasource.password=bookverse_dev_2026

# Force JVM timezone for Hibernate
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# Auto-create schema for local dev (update = persist data between restarts)
spring.jpa.hibernate.ddl-auto=update
# CRITICAL: show-sql=true causes MASSIVE overhead (1800ms+ per request)
# It writes every SQL statement to console, which is extremely slow.
# Only enable temporarily when debugging a specific query.
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# Hibernate will update schema from entities
spring.jpa.properties.hibernate.hbm2ddl.auto=update

# ==============================================================================
# 2. HIKARI CONNECTION POOL (Fixed for stability)
# ==============================================================================
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.connection-timeout=20000
# LEAK DETECTION: Log warning if connection held > 45 seconds (increased from 30s)
# This accounts for homepage parallel API calls that may queue up
spring.datasource.hikari.leak-detection-threshold=45000
# Auto-evict connections that have been open too long
spring.datasource.hikari.max-lifetime=600000

# JPA/Hibernate optimization to prevent connection hogging
spring.jpa.open-in-view=false

# ==============================================================================
# 3. STRIPE PAYMENT (Test mode - same as prod)
# ==============================================================================
stripe.api.key=sk_test_51ShW65HEtRpFYPhUKWiUGfCOpzSk7NAizpG72EXaDNjzmDqhwLJVGp6CtTlpxzm4jg8thF6c0uDT9gZnqeOh2n2b00zjEL14d2
stripe.publishable.key=pk_test_51ShW65HEtRpFYPhU4tjkaI9N76sjH4SQNX4BQF8txPZ3fL4rJpnKSWOGNLiy5ILxVpUTNJAAceKJDub9DAHbQaaZ00D3gy4b4u

# ==============================================================================
# 4. MAIL (Disabled for local dev - use console logging)
# ==============================================================================
spring.mail.host=localhost
spring.mail.port=1025
# For local dev, we don't send real emails
# Use MailHog or similar if needed: docker run -p 1025:1025 -p 8025:8025 mailhog/mailhog

# ==============================================================================
# 5. SECURITY & JWT (Same keys for consistency)
# ==============================================================================
jwt.signerKey=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
jwt.valid-duration=86400

# ==============================================================================
# 6. LOGGING (Production-like for performance)
# ==============================================================================
# CRITICAL: SQL debug logging causes 1800ms overhead per request!
# Only enable these temporarily when debugging a specific query.
#logging.level.org.hibernate.SQL=DEBUG
#logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.com.example.bookverseserver=INFO
