# Bookverse Local Development Stack
# Usage: docker compose up -d

services:
  # ============================================================================
  # LOCAL DEVELOPMENT DATABASE
  # ============================================================================
  # Use with: .\dev.bat -docker
  # Fresh schema every restart (no constraint conflicts!)
  # ============================================================================
  postgres:
    container_name: bookverse-postgres-local
    image: postgres:15
    restart: unless-stopped
    environment:
      POSTGRES_DB: bookversedb
      POSTGRES_USER: bookverse
      POSTGRES_PASSWORD: bookverse_dev_2026
      TZ: Asia/Ho_Chi_Minh
      PGTZ: Asia/Ho_Chi_Minh
    ports:
      - "5432:5432"
    volumes:
      - bookverse_postgres_data:/var/lib/postgresql/data
    networks:
      - bookverse-local
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U bookverse -d bookversedb"]
      interval: 5s
      timeout: 5s
      retries: 5

  # ============================================================================
  # OPTIONAL: MailHog for local email testing
  # ============================================================================
  # Access UI at: http://localhost:8025
  # mailhog:
  #   container_name: bookverse-mailhog
  #   image: mailhog/mailhog
  #   ports:
  #     - "1025:1025"  # SMTP
  #     - "8025:8025"  # Web UI
  #   networks:
  #     - bookverse-local

volumes:
  bookverse_postgres_data:

networks:
  bookverse-local:
    driver: bridge
